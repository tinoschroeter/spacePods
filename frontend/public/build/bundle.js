(()=>{var C=Object.defineProperty;var M=(i,t,s)=>t in i?C(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var l=(i,t,s)=>(M(i,typeof t!="symbol"?t+"":t,s),s);var e={entity:document.getElementById("entityCanvas"),star1:document.getElementById("starCanvas1"),star2:document.getElementById("starCanvas2"),star3:document.getElementById("starCanvas3")},o={entity:e.entity.getContext("2d"),star1:e.star1.getContext("2d"),star2:e.star2.getContext("2d"),star3:e.star3.getContext("2d")};function f(i,t=1){i.width=t*window.innerWidth,i.height=t*window.innerHeight}function b(){f(e.entity),f(e.star1,2),f(e.star2,2),f(e.star3,2)}function x(i){o[i].clearRect(0,0,e[i].width,e[i].height)}function I(i,t){let s;return(...r)=>{s&&clearTimeout(s),s=setTimeout(()=>{i(...r)},t)}}function n(i,t){return i+Math.floor((t-i)*Math.random())}function u(i){return i[n(0,i.length)]}function w(i,t){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))}var y={},z=["ship","asteroid-l","asteroid-m","asteroid-s"];function S(i){function t(s){if(s<z.length){let r=new Image;r.onload=()=>{t(s+1)},y[z[s]]=r,r.src=`./img/${z[s]}.png`}else i()}t(0)}var A=document.querySelectorAll(".screen");function v(){A.forEach(i=>i.classList.remove("visible"))}function p(i){v(),document.getElementById(`${i}Screen`).classList.add("visible")}var h=class{static removeAll(){h.list=[]}static startGenerating(t=1e3){h.interval=setInterval(()=>{fetch(h.api).then(s=>s.json()).then(s=>{h.count=s.length,s.forEach(r=>new h(r.name))}).catch(s=>console.error(s))},t)}static stopGenerating(){clearInterval(h.interval)}constructor(t){if(h.list.find(c=>c.podName===t))return;this.podName=t,this.type=u(["l","m"]);let s="asteroid-"+this.type;switch(this.image=y[s],this.size=h.SIZE[this.type],u(["left","right","top","bottom"])){case"left":this.pos={x:-this.size/2,y:n(0,e.star1.height)},this.vel={x:n(1,3),y:n(-2,4)};break;case"right":this.pos={x:e.star1.width+this.size/2,y:n(0,e.star1.height)},this.vel={x:-n(1,3),y:n(-2,4)};break;case"top":this.pos={x:n(0,e.star1.width),y:-this.size/2},this.vel={x:n(-2,4),y:n(1,3)};break;case"bottom":this.pos={x:n(0,e.star1.width),y:e.star1.height+this.size/2},this.vel={x:n(-2,4),y:-n(1,3)};break}this.animationTimer=0,this.frameCount=h.FRAME_COUNT[this.type],this.parallax=1,this.drawPos={x:0,y:0},this.destroyed=!1,this.score=h.SCORE[this.type],h.list.push(this)}update(t){this.animationTimer++,this.animationTimer>=this.frameCount&&(this.animationTimer=0),this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.drawPos={x:this.pos.x-this.parallax*t.pos.x,y:this.pos.y-this.parallax*t.pos.y},this.destroyed&&(this.vel={x:0,y:0},this.size*=.8,this.size<=1&&this.destroy()),this.removeIfOutside()}draw(){o.entity.save(),o.entity.translate(this.drawPos.x,this.drawPos.y),o.entity.drawImage(this.image,this.animationTimer*h.SIZE[this.type],0,h.SIZE[this.type],h.SIZE[this.type],-this.size/2,-this.size/2,this.size,this.size),o.entity.fillStyle="#FFA500",o.entity.font="18px serif",o.entity.textAlign="center",o.entity.fillText(this.podName,0,0),o.entity.restore()}removeIfOutside(){(this.pos.x+this.size/2<0||this.pos.y+this.size/2<0||this.pos.x>e.star1.width+this.size/2||this.pos.y>e.star1.height+this.size/2)&&this.remove()}remove(){h.list=h.list.filter(t=>t!=this)}destroy(){fetch(`${h.api}/${this.podName}`,{method:"DELETE"}).then(t=>t.json()).then(t=>console.log(t)).catch(t=>console.error(t)),this.remove()}destroyShip(t){!t.destroyed&&w(t.pos,this.drawPos)<t.size.x/2+this.size/2&&(t.destroyed=!0,t.rotationForce=u([1,-1])*.2,p("gameover"))}},a=h;l(a,"list",[]),l(a,"counts",0),l(a,"api","/api/pods"),l(a,"SIZE",{m:64,l:128}),l(a,"FRAME_COUNT",{m:60,l:120}),l(a,"SCORE",{m:1,l:1}),l(a,"interval",null);var m=class{constructor({pos:t,initialVel:s,rotation:r}){this.pos=t,this.rotation=r,this.speed=15,this.vel={x:s.x+this.speed*Math.cos(r),y:s.y+this.speed*Math.sin(r)},m.list.push(this)}draw(){o.entity.save(),o.entity.fillStyle="green",o.entity.globalAlpha=.8,o.entity.translate(this.pos.x,this.pos.y),o.entity.rotate(this.rotation),o.entity.fillRect(0,-2,40,4),o.entity.fillStyle="white",o.entity.fillRect(0,-.5,40,1),o.entity.restore()}update(t){this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.destroyPod(t),this.removeIfOutside()}removeIfOutside(){(this.pos.x<0||this.pos.x>e.star1.width||this.pos.y<0||this.pos.y>e.star1.height)&&this.remove()}remove(){m.list=m.list.filter(t=>t!=this)}destroyPod(t){a.list.forEach(s=>{w(this.pos,s.drawPos)<s.size/2&&(s.destroyed=!0,t.score+=s.score,t.showScore(),this.remove())})}},d=m;l(d,"list",[]);var g=class{constructor(){this.image=y.ship,this.size={x:100,y:100},this.pos={x:e.entity.width/2,y:e.entity.height/2},this.vel={x:.6,y:0},this.force={x:0,y:0},this.maximalForce=.48,this.friction=.98,this.rotation=0,this.rotationVel=0,this.rotationForce=0,this.rotationMaximalForce=.07,this.rotationFriction=.01,this.status="idle",this.frames={idle:0,boost_forwards:1,boost_backwards:2,turn_right:3,turn_left:4},this.destroyed=!1,this.score=0,this.alpha=1,this.scoreDisplay=document.getElementById("scoreDisplay"),this.podDisplay=document.getElementById("podDisplay"),this.scoreDisplayEnd=document.getElementById("scoreDisplayEnd"),this.addControls()}update(){this.vel.x+=this.force.x,this.vel.y+=this.force.y,this.force.x=0,this.force.y=0,this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.vel.x*=this.friction,this.vel.y*=this.friction,this.rotationVel+=this.rotationForce,this.rotationForce=0,this.rotation+=this.rotationVel,this.rotationVel*=this.rotationFriction,this.destroyed&&(this.alpha*=.95,this.alpha<=.01&&(this.alpha=0)),this.handleTinyVel(),this.boundToCanvas()}handleTinyVel(t=.01){Math.abs(this.vel.x)<t&&(this.vel.x=0),Math.abs(this.vel.y)<t&&(this.vel.y=0),Math.abs(this.rotationVel)<t&&(this.rotationVel=0)}boundToCanvas(){this.pos.x=Math.max(10,Math.min(e.entity.width,this.pos.x)),this.pos.y=Math.max(10,Math.min(e.entity.height,this.pos.y))}draw(){o.entity.save(),o.entity.globalAlpha=this.alpha,o.entity.translate(this.pos.x,this.pos.y),o.entity.rotate(this.rotation),o.entity.drawImage(this.image,this.frames[this.status]*this.size.x,0,this.size.x,this.size.y,-this.size.x/2,-this.size.y/2,this.size.x,this.size.y),o.entity.restore()}showScore(){this.scoreDisplay.innerText=`Kill: ${this.score}`,this.scoreDisplayEnd.innerText=`Kill: ${this.score}`}showPods(){let t=()=>this.podDisplay.innerText=a.count?`Pods:  ${a.count}`:"Pods:  0";t(),setInterval(()=>t(),1e3)}addControls(){window.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":this.boost({direction:"forwards"});break;case"ArrowDown":this.boost({direction:"backwards"});break;case"ArrowLeft":this.turn({direction:"left"});break;case"ArrowRight":this.turn({direction:"right"});break;case" ":this.shoot();break}}),window.addEventListener("keyup",t=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)&&(this.status="idle")})}shoot(){this.destroyed||new d({pos:{...this.pos},initialVel:{...this.vel},rotation:this.rotation})}turn({direction:t}){if(this.destroyed)return;this.status=`turn_${t}`;let s=t=="right"?1:-1;this.rotationForce=s*this.rotationMaximalForce}boost({direction:t}){if(this.destroyed)return;this.status=`boost_${t}`;let s=t=="forwards"?1:-1;this.force={x:s*this.maximalForce*Math.cos(this.rotation),y:s*this.maximalForce*Math.sin(this.rotation)}}reset(){this.score=0,this.showScore(),this.destroyed=!1,this.status="idle",this.rotation=0,this.rotationVel=0,this.vel={x:0,y:0},this.alpha=1}};var E=class{constructor(){this.sizes=["1","2","3"],this.list={1:[],2:[],3:[]},this.number={1:3e3,2:1e3,3:700},this.parallax={1:.75,2:.8,3:.85},this.alpha={1:.5,2:.7,3:.8},this.color="rgb(200, 179, 79)",this.scale=1,this.scaleVel=25e-5,this.updateCanvas({x:e.entity.width/2,y:e.entity.height/2})}generate(){for(let t of this.sizes){this.list[t]=[];for(let s=0;s<this.number[t];s++){let r=n(0,e[`star${t}`].width),c=n(0,e[`star${t}`].height);this.list[t].push({x:r,y:c})}}}draw(){for(let t of this.sizes)x(`star${t}`),o[`star${t}`].fillStyle=this.color,o[`star${t}`].globalAlpha=this.alpha[t],this.list[t].forEach(({x:s,y:r})=>{o[`star${t}`].beginPath(),o[`star${t}`].arc(s,r,t/2,0,2*Math.PI),o[`star${t}`].fill()})}update(t){this.updateCanvas(t.pos),this.updateScale()}updateScale(){this.scale+=this.scaleVel,(this.scale>1.7||this.scale<1)&&(this.scaleVel*=-1)}updateCanvas(t){for(let s of this.sizes){let r={x:-this.parallax[s]*t.x,y:-this.parallax[s]*t.y};e[`star${s}`].style.transform=`translateX(${r.x}px)translateY(${r.y}px)scale(${this.scale})`}}};b();p("loading");S(()=>{p("start");let i=new E,t=new g,s=!1;i.generate(),i.draw(),window.addEventListener("keydown",c=>{c.key=="Enter"&&(t.destroyed?(v(),a.removeAll(),t.reset()):s?(p("pause"),s=!1,a.stopGenerating()):s||(v(),s=!0,a.startGenerating(),t.showScore(),t.showPods(),r()))}),window.addEventListener("resize",I(()=>{b(),i.generate(),i.draw()},150));function r(){x("entity"),[...d.list,...a.list,t,i].forEach(c=>c.update(t)),[...d.list,...a.list,t].forEach(c=>c.draw()),s&&requestAnimationFrame(r)}});})();
//# sourceMappingURL=bundle.js.map
